{% extends "admin/base_site.html" %}
{% load static from staticfiles %}
{% load bfrs_tags %}

{% block breadcrumbs %}
<ul class="breadcrumb">
  <li><a href="{% url 'main' %}">Bushfire Overview</a></li>
  <li><a href="{{bushfireurl}}">{% if bushfire.report_status == bushfire.STATUS_INVALIDATED %} 
        <font color="red">{{ bushfire.fire_number}} (Invalid)</font>
      {% elif bushfire.report_status == bushfire.STATUS_MERGED %} 
        <font color="red">{{ bushfire.fire_number}} (Merged)</font>
      {% elif bushfire.report_status == bushfire.STATUS_DUPLICATED %} 
        <font color="red">{{ bushfire.fire_number}} (Duplicated)</font>
      {% else %}
        {{ bushfire.fire_number }}
      {% endif %}
  </a></li>
  {% if snapshot %}
  <li>snapshot</li>
  {% endif %}
  <li>Documents</li>
</ul>
{% endblock %}

{% block content %}
<table style="width:100%">
<tr>
    <td style="padding-left:0px">
      <h1 style="float:left">Bushfire Documents</h1>
    </td>
    <td style="vertical-align:bottom;padding-right:0px">
      <span style="float:right">
        <form id="document_filter_form" action="" method="get">
          <span class="controls">{{ filterform.title }}</span>

          <span class="controls" style="padding-left:50px">{{ filterform.include_deleted }}</span>
          <label class="nowrap" >Include deleted</label>

          <button type="submit"  class="btn btn-primary btn-success" style="margin-left:50px" ><i class="icon-refresh icon-white"></i> Search</button>
          <button class="btn btn-primary btn-info" type="button" style="padding-left:20px" onclick="window.location='{% url "bushfire:bushfire_document_upload"  bushfireid=bushfire.id %}'"><i class="icon-upload-alt"></i> Document</button>
        </form>
      </span>
    </td>
</tr>
</table>

<table id="table" class="table table-striped table-bordered table-hover table-condensed" style="cursor:pointer;">
  <thead>
     <th onclick="document.location='{{filters_without_order}}{{'title'|toggle_sort:filterform.initial}}'" class="headerSort {{'title'|sort_class:filterform.initial}}">
       <font color="dodgerblue">Title</font>
     </th>
     <th onclick="document.location='{{filters_without_order}}{{'document'|toggle_sort:filterform.initial}}'" class="headerSort {{'document'|sort_class:filterform.initial}}">
       <font color="dodgerblue">Document</font>
     </th>
     <th onclick="document.location='{{filters_without_order}}{{'creator'|toggle_sort:filterform.initial}}'" class="headerSort {{'creator'|sort_class:filterform.initial}}">
       <font color="dodgerblue">Uploaded By</font>
     </th>
     <th onclick="document.location='{{filters_without_order}}{{'created'|toggle_sort:filterform.initial}}'" class="headerSort {{'created'|sort_class:filterform.initial}}">
       <font color="dodgerblue">Uploaded on</font>
     </th>
    <th ></th>
  </thead>
  <tbody>
    {% for doc in object_list %}
      <tr class="row-vm" data-toggle="myCollapse" data-target="#{{bushfire.id}}">
          <td>{{doc.document_title}}</td>
          <td>
              {{doc.file_name}}
              {% if doc.deleted %}
              <br><span style="color:red;font-style:italic">Deleted by {{doc.deleteby}} on {{doc.deleteon | date:"Y-m-d H:i:s"}}</span>
              {% endif %}
          </td>
          <td>{{doc.creator}}</td>
          <td>{{doc.created | date:"Y-m-d H:i:s"}}</td>
          <td>
              {% if not doc.deleted %}
              <a style="margin-left:10px" href="{% url "bushfire:document_update" doc.id %}" title="Edit Document"><i class="icon-edit"></i></a>
              {% endif %}
              <a style="margin-left:10px" href="{% url "bushfire:document_view" doc.id %}" title="View Document"><i class="icon-eye-open"></i></a>
              {% if not doc.deleted %}
              <a style="margin-left:10px" href="{% url "bushfire:document_download" doc.id  %}" title="Download Document"><i class="icon-download-alt"></i></a>
              <a style="margin-left:10px" href="{% url "bushfire:document_delete" doc.id %}" title="Delete Document"><i class="icon-trash"></i></a>
              {% endif %}
          </td>
      </tr>
    {% empty %}
      <tr>
          <td colspan="5" style="text-align:center">There are no documents</td>
      </tr>
    {% endfor %}
  </tbody>
</table>


<!-- js bushfire_filter() function used below to allow pagination to work with the filters (filter params are combined in the fucntions)-->
{% if is_paginated %}
  <ul class="pagination">
    {% if page_obj.has_previous %}
      <!--li><a href="javascript: bushfire_filter({page:{{ page_obj.previous_page_number }}});">&laquo;</a></li-->
      <li><a href="{{filters}}page={{ page_obj.previous_page_number }}">&laquo;</a></li>
    {% else %}
      <li class="disabled"><span>&laquo;</span></li>
    {% endif %}
    {% for i in paginator.page_range %}
      {% if page_obj.number == i %}
        <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
      {% else %}
        <!--li><a href="javascript: bushfire_filter({page:{{ i }}});">{{ i }}</a></li-->
        <li><a href="{{filters}}page={{ i }}">{{ i }}</a></li>
      {% endif %}
    {% endfor %}
    {% if page_obj.has_next %}
      <!--li><a href="javascript: bushfire_filter({page:{{ page_obj.next_page_number }}});">&raquo;</a></li-->
      <li><a href="{{filters}}page={{ page_obj.next_page_number }}">&raquo;</a></li>
    {% else %}
      <li class="disabled"><span>&raquo;</span></li>
    {% endif %}
  </ul>
{% endif %}

</script>
{% endblock %}
